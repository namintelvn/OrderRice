var registerDialog,captureOrderDialog,listUserGameDialog,wheelGameDialog,socket=io(window.location.href),itemPrice=32e3,countRegister=0;socket.on("server-register-failed",function(){$("#register_label").html("Someone take your name then change it.")}),socket.on("server-register-success",function(e){countRegister=-1,registerDialog.dialog("close"),localStorage.setItem("name",e)}),socket.on("server-getlistfood",function(e){$("#content").html(e),$("img").each(function(e,t){""!=$(t).attr("src")&&$(t).attr("src","https://www.anzi.com.vn"+$(t).attr("src"))}),$(".des").remove(),$(".update").remove(),$(".name").each(function(e,t){var r=$(this).text().trim();$(this).after(`<button name="${r}" class="btn-order btn btn-primary">Order</button>`),socket.emit("client-order",{name:r,flag:0})}),$(".btn-order").each(function(e,t){$(t).click(function(e){localStorage.getItem("name")&&("Order"==$(this).text().trim()?($(this).text("Cancel").removeClass("btn-primary").addClass("btn-danger"),socket.emit("client-order",{name:$(this).attr("name"),flag:1})):($(this).text("Order").addClass("btn-primary").removeClass("btn-danger"),socket.emit("client-order",{name:$(this).attr("name"),flag:-1})))})}),$("#order").css("display","")}),socket.on("server-getlistorder",function(e){var t=e.orderItems,r=0,o=[];$("#order tbody").html("");var a=localStorage.getItem("name");for(const e in t)if(t.hasOwnProperty(e)){const n=t[e].quantity,i=t[e].orderUser;r+=n,$("#order tbody").append(`\n        <tr>\n          <td>${e}</td>\n          <td>${n}</td>\n          <td>${itemPrice.toLocaleString()} đ</td>\n          <td>${Object.keys(i).filter(e=>1==i[e])}</td>\n        </tr>\n      `),i[a]&&o.push(e)}for(const e of o)$(`.btn-order[name="${e}"]`).text("Cancel").removeClass("btn-primary").addClass("btn-danger");$("#orderCount").text(r),$("#orderMoney").text((r*itemPrice).toLocaleString()+" đ"),""!==e.log&&$("textarea").text($("textarea").text()+"\n"+e.log)}),socket.on("error",function(e){console.log(e)}),socket.on("server-getUsers",function(e){var t="";e.map(e=>{t+=`<input type="checkbox" name="${e}">\n              <label>${e}</label><br>`}),$("#dialog-listUser").html(t),listUserGameDialog.dialog("open")}),$(document).ready(function(){function e(){$("#register_name").val()&&socket.emit("client-register",{targetName:escape($("#register_name").val()),flag:1})}registerDialog=$("#dialog-register").dialog({autoOpen:!1,buttons:{Register:e},close:function(){switch(countRegister){case-1:return;case 0:$("#register_label").html("Tell me who are you ?"),countRegister++;break;case 1:$("#register_label").html("Don't make ask twice! Who the fuck are you?"),countRegister++;break;case 2:$("#register_label").html("You wanna die? Last chance, who are you?"),countRegister++;break;default:window.close()}registerDialog.dialog("open")}}),captureOrderDialog=$("#dialog-capture-order").dialog({autoOpen:!1,title:'* Press right mouse then choose "Copy Image"',width:"auto"}),$("#capture_order").click(function(){$("#order td:nth-child(4)").css("display","none"),html2canvas(document.querySelector("#order table")).then(e=>{e.toBlob(function(e){const t=new ClipboardItem({"image/png":e});try{navigator.clipboard.write([t]),$("#order td:nth-child(4)").css("display",""),setTimeout(()=>{alert("Ctrl-V to paste order list image.")},100)}catch(t){console.log(t),function(e){var t=(window.URL||window.webkitURL).createObjectURL(e);$("#img-capture-order").attr("src",t),captureOrderDialog.dialog("open")}(e)}})})}),function(){const e=localStorage.getItem("name");e?socket.emit("client-register",{targetName:e,flag:0}):registerDialog.dialog("open")}(),socket.emit("client-getlistfood"),socket.emit("client-getlistorder","")});